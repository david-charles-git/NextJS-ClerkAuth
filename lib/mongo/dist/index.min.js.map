{"version":3,"sources":["index.ts"],"names":["mongodb_1","require","_a","process","env","MONGODB_URI","MONGODB_DB","Error","cached","global","mongo","connectToDatabase","conn","promise","options","useNewUrlParser","useUnifiedTopology","MongoClient","connect","then","client","db","_b","sent","exports"],"mappings":"y7CAAA,IAAAA,UAAAC,QAAA,WAEMC,GAAAC,QAAAC,IAAEC,YAAAH,GAAAG,YAAaC,WAAAJ,GAAAI,WAErB,IAAKD,YAAe,MAAME,MAAM,oEAEhC,IAAKD,WAAc,MAAMC,MAAM,uEAE/B,IAAIC,OAASC,OAAOC,MAIpB,SAAsBC,sIAClB,OAAIH,OAAOI,KAAQ,CAAA,EAAOJ,OAAOI,OAE5BJ,OAAOK,UACFC,EAAU,CACZC,iBAAkB,EAClBC,oBAAqB,GAGzBR,OAAOK,QAAUb,UAAAiB,YAAYC,QAAQb,YAAaS,GAASK,KAAK,SAACC,GAC7D,MAAO,CAAEA,OAAMA,EAAEC,GAAKD,EAAOC,GAAGf,gBAI1B,CAAA,GAAdJ,EAAAM,QAA2BK,iBAE3B,OAFAX,EAAOU,KAAOU,EAAAC,OAEd,CAAA,EAAOf,OAAOI,WAlBHJ,OAAVA,SAAmBC,OAAOC,MAAQ,CAAEE,KAAM,KAAMC,QAAS,OAE9DW,QAAAb,kBAAAA","file":"index.min.js","sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nconst { MONGODB_URI, MONGODB_DB } = process.env;\r\n\r\nif (!MONGODB_URI) { throw Error(\"Please define the MONGODB_URI environment variable in .env.local\"); }\r\n\r\nif (!MONGODB_DB) { throw Error(\"Please define the MONGODB_DB enrironment variable in the .env.local\"); }\r\n\r\nvar cached = global.mongo;\r\n\r\nif (!cached) { cached = global.mongo = { conn: null, promise: null }; }\r\n\r\nexport async function connectToDatabase() {\r\n    if (cached.conn) { return cached.conn; }\r\n\r\n    if (!cached.promise) {\r\n        const options = {\r\n            useNewUrlParser : true,\r\n            useUnifiedTopology : true\r\n        };\r\n\r\n        cached.promise = MongoClient.connect(MONGODB_URI, options).then((client) => {\r\n            return { client, db : client.db(MONGODB_DB) }\r\n        });\r\n    }\r\n\r\n    cached.conn = await cached.promise;\r\n\r\n    return cached.conn;\r\n}"]}